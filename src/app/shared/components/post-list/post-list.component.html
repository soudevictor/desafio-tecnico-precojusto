<div class="posts-list">
  <section class="posts-list__container max-w-7xl mx-auto p-6">
    <div class="flex justify-between items-center mb-6">
      <h1 class="text-3xl font-bold text-gray-800">Lista de Posts</h1>

      <!-- NOTE: Bot√£o pra criar novo post -->
      <a
        routerLink="/post/novo"
        class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700 font-medium transition-colors"
        aria-label="Criar novo post"
      >
        + Novo Post
      </a>
    </div>

    @if (errorMessage()) {
    <div
      class="error-message bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-6"
      role="alert"
    >
      <strong class="font-bold">Erro!</strong>
      <span class="block sm:inline"> {{ errorMessage() }}</span>
    </div>
    } @if (isLoading()) {
    <div class="loading-state text-center py-12">
      <div
        class="inline-block animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600"
        role="status"
        aria-label="Carregando posts"
      ></div>
      <p class="text-gray-600 mt-4 text-lg">Carregando posts...</p>
    </div>
    } @else {

    <!-- NOTE: Controles de busca e itens por p√°gina -->
    <div class="posts-controls flex flex-col sm:flex-row gap-4 mb-6">
      <!-- INFO: Input de busca com ngModel (two-way binding igual ao controlled input do React) -->
      <div class="posts-controls__search flex-1">
        <label for="busca-posts" class="sr-only">Buscar posts</label>
        <input
          id="busca-posts"
          type="text"
          placeholder="Buscar por t√≠tulo ou conte√∫do..."
          [ngModel]="textoBusca()"
          (ngModelChange)="onBusca($event)"
          class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
          aria-label="Campo de busca de posts"
        />
      </div>

      <!-- NOTE: Select pra escolher quantos itens por p√°gina -->
      <div class="posts-controls__per-page flex items-center gap-2">
        <label for="itens-pagina" class="text-sm text-gray-600">Exibir:</label>
        <select
          id="itens-pagina"
          [ngModel]="itensPorPagina()"
          (ngModelChange)="onItensPorPaginaChange($event)"
          class="border border-gray-300 rounded-lg px-3 py-2"
          aria-label="Quantidade de itens por p√°gina"
        >
          <option [value]="5">5</option>
          <option [value]="10">10</option>
          <option [value]="25">25</option>
          <option [value]="50">50</option>
        </select>
        <span class="text-sm text-gray-600">por p√°gina</span>
      </div>
    </div>

    <!-- NOTE: Info de quantos resultados -->
    <div class="text-sm text-gray-600 mb-4" aria-live="polite">
      Mostrando {{ postsPaginados().length }} de {{ postsFiltrados().length }} posts @if
      (textoBusca()) {
      <span class="ml-2 bg-blue-100 text-blue-800 px-2 py-1 rounded text-xs">
        Busca: "{{ textoBusca() }}"
        <button (click)="onBusca('')" class="ml-1 hover:text-blue-600" aria-label="Limpar busca">
          ‚úï
        </button>
      </span>
      }
    </div>

    <div class="posts-table overflow-x-auto shadow-md rounded-lg">
      <table
        class="posts-table__content min-w-full bg-white"
        role="grid"
        aria-label="Tabela de posts"
      >
        <!-- NOTE: Headers clic√°veis pra ordenar -->
        <thead class="posts-table__header bg-gray-100 border-b-2 border-gray-200">
          <tr>
            <th
              (click)="onOrdenar('id')"
              class="px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider cursor-pointer hover:bg-gray-200"
              role="columnheader"
              [attr.aria-sort]="
                colunaOrdenacao() === 'id'
                  ? direcaoOrdenacao() === 'asc'
                    ? 'ascending'
                    : 'descending'
                  : 'none'
              "
            >
              ID {{ getIconeOrdenacao('id') }}
            </th>
            <th
              (click)="onOrdenar('title')"
              class="px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider cursor-pointer hover:bg-gray-200"
              role="columnheader"
              [attr.aria-sort]="
                colunaOrdenacao() === 'title'
                  ? direcaoOrdenacao() === 'asc'
                    ? 'ascending'
                    : 'descending'
                  : 'none'
              "
            >
              T√≠tulo {{ getIconeOrdenacao('title') }}
            </th>
            <th
              (click)="onOrdenar('body')"
              class="px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider cursor-pointer hover:bg-gray-200"
              role="columnheader"
              [attr.aria-sort]="
                colunaOrdenacao() === 'body'
                  ? direcaoOrdenacao() === 'asc'
                    ? 'ascending'
                    : 'descending'
                  : 'none'
              "
            >
              Conte√∫do {{ getIconeOrdenacao('body') }}
            </th>
            <th
              (click)="onOrdenar('userId')"
              class="px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider cursor-pointer hover:bg-gray-200"
              role="columnheader"
              [attr.aria-sort]="
                colunaOrdenacao() === 'userId'
                  ? direcaoOrdenacao() === 'asc'
                    ? 'ascending'
                    : 'descending'
                  : 'none'
              "
            >
              Usu√°rio {{ getIconeOrdenacao('userId') }}
            </th>
            <th
              class="px-6 py-3 text-left text-xs font-medium text-gray-700 uppercase tracking-wider"
              role="columnheader"
            >
              A√ß√µes
            </th>
          </tr>
        </thead>
        <tbody class="posts-table__body divide-y divide-gray-200">
          <!-- INFO: @for √© a nova sintaxe do Angular (igual ao .map() do React) -->
          <!-- NOTE: Agora usa postsPaginados() que j√° est√° filtrado, ordenado e paginado -->
          @for (post of postsPaginados(); track post.id) {
          <tr class="posts-table__row hover:bg-gray-50 transition-colors">
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
              {{ post.id }}
            </td>
            <td class="px-6 py-4 text-sm font-medium text-gray-900">
              {{ post.title }}
            </td>
            <td class="px-6 py-4 text-sm text-gray-600 max-w-xs truncate">
              {{ post.body }}
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
              {{ post.userId }}
            </td>
            <td class="px-6 py-4 whitespace-nowrap text-sm">
              <div class="flex items-center gap-2">
                <a
                  [routerLink]="['/post', post.id]"
                  class="text-blue-600 hover:text-blue-800 font-medium hover:underline"
                  [attr.aria-label]="'Ver detalhes do post ' + post.title"
                  title="Ver detalhes"
                >
                  üëÅÔ∏è
                </a>
                <a
                  [routerLink]="['/post', post.id, 'edit']"
                  class="text-yellow-600 hover:text-yellow-800 font-medium"
                  [attr.aria-label]="'Editar post ' + post.title"
                  title="Editar post"
                >
                  ‚úèÔ∏è
                </a>
                <button
                  (click)="openDeleteModal(post.id)"
                  class="text-red-600 hover:text-red-800 font-medium"
                  [attr.aria-label]="'Excluir post ' + post.title"
                  title="Excluir post"
                >
                  üóëÔ∏è
                </button>
              </div>
            </td>
          </tr>
          } @empty {
          <!-- INFO: @empty √© executado quando a lista est√° vazia -->
          <tr>
            <td colspan="5" class="px-6 py-8 text-center text-gray-500">
              @if (textoBusca()) { Nenhum post encontrado para "{{ textoBusca() }}". } @else {
              Nenhum post dispon√≠vel. }
            </td>
          </tr>
          }
        </tbody>
      </table>
    </div>

    <!-- NOTE: Pagina√ß√£o -->
    @if (totalPaginas() > 1) {
    <div class="posts-pagination flex items-center justify-between mt-6">
      <div class="text-sm text-gray-600">P√°gina {{ paginaAtual() }} de {{ totalPaginas() }}</div>

      <div class="flex items-center gap-1">
        <!-- NOTE: Bot√£o anterior -->
        <button
          (click)="paginaAnterior()"
          [disabled]="paginaAtual() === 1"
          class="px-3 py-2 rounded-lg border border-gray-300 text-sm font-medium"
          [class.opacity-50]="paginaAtual() === 1"
          [class.cursor-not-allowed]="paginaAtual() === 1"
        >
          ‚Üê Anterior
        </button>

        <!-- NOTE: N√∫meros das p√°ginas -->
        @for (pagina of numerosPaginas(); track pagina) { @if (pagina === 1 || pagina ===
        totalPaginas() || (pagina >= paginaAtual() - 2 && pagina <= paginaAtual() + 2)) {
        <button
          (click)="irParaPagina(pagina)"
          class="px-3 py-2 rounded-lg text-sm font-medium"
          [class.bg-blue-600]="pagina === paginaAtual()"
          [class.text-white]="pagina === paginaAtual()"
          [class.border]="pagina !== paginaAtual()"
          [class.border-gray-300]="pagina !== paginaAtual()"
          [class.hover:bg-gray-100]="pagina !== paginaAtual()"
        >
          {{ pagina }}
        </button>
        } @else if (pagina === paginaAtual() - 3 || pagina === paginaAtual() + 3) {
        <span class="px-2 text-gray-400">...</span>
        } }

        <!-- NOTE: Bot√£o pr√≥ximo -->
        <button
          (click)="proximaPagina()"
          [disabled]="paginaAtual() === totalPaginas()"
          class="px-3 py-2 rounded-lg border border-gray-300 text-sm font-medium"
          [class.opacity-50]="paginaAtual() === totalPaginas()"
          [class.cursor-not-allowed]="paginaAtual() === totalPaginas()"
        >
          Pr√≥ximo ‚Üí
        </button>
      </div>
    </div>
    } }
  </section>

  <!-- NOTE: Modal de confirma√ß√£o de exclus√£o -->
  @if (showDeleteModal()) {
  <dialog open class="delete-modal fixed inset-0 z-50 flex items-center justify-center">
    <div
      class="delete-modal__overlay fixed inset-0 bg-black bg-opacity-50"
      (click)="closeDeleteModal()"
    ></div>

    <div
      class="delete-modal__content bg-white rounded-lg shadow-xl p-6 relative z-10 max-w-md w-full mx-4"
    >
      <h2 class="text-xl font-bold text-gray-900 mb-4">Confirmar Exclus√£o</h2>

      <p class="text-gray-700 mb-6">
        Tem certeza que deseja excluir o post #{{ postToDeleteId() }}? Esta a√ß√£o n√£o pode ser
        desfeita.
      </p>

      <div class="delete-modal__actions flex gap-3 justify-end">
        <button
          (click)="closeDeleteModal()"
          class="px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300 font-medium transition-colors"
        >
          Cancelar
        </button>
        <button
          (click)="confirmDelete()"
          class="px-4 py-2 bg-red-600 text-white rounded hover:bg-red-700 font-medium transition-colors"
        >
          Excluir
        </button>
      </div>
    </div>
  </dialog>
  }
</div>
