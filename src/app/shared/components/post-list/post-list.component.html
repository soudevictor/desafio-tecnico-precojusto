<div class="posts-feed">
  <!-- NOTE: Container centralizado estilo feed de rede social -->
  <section class="posts-feed__container max-w-2xl mx-auto px-4 py-6">
    @if (errorMessage()) {
    <div
      class="error-message bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded-xl mb-6"
      role="alert"
    >
      <div class="flex items-center gap-2">
        <i class="fa-solid fa-circle-exclamation"></i>
        <span>{{ errorMessage() }}</span>
      </div>
    </div>
    } @if (isLoading()) {
    <app-spinner mensagem="Carregando posts..." tamanho="lg" />
    } @else {

    <!-- NOTE: Controles de busca e filtros -->
    <div class="posts-controls bg-white rounded-xl shadow-sm p-4 mb-6 border border-slate-200">
      <div class="flex flex-col sm:flex-row gap-3">
        <!-- Input de busca estilizado -->
        <div class="flex-1 relative">
          <i
            class="fa-solid fa-magnifying-glass absolute left-3 top-1/2 -translate-y-1/2 text-slate-400"
          ></i>
          <input
            id="busca-posts"
            type="text"
            placeholder="Buscar posts..."
            [ngModel]="textoBusca()"
            (ngModelChange)="onBusca($event)"
            class="w-full pl-10 pr-4 py-2.5 bg-slate-100 border-0 rounded-full focus:ring-2 focus:ring-blue-500 focus:bg-white transition-all duration-200"
            aria-label="Campo de busca de posts"
          />
        </div>

        <!-- Select de ordenação -->
        <div class="flex items-center gap-2">
          <select
            [ngModel]="itensPorPagina()"
            (ngModelChange)="onItensPorPaginaChange($event)"
            class="bg-slate-100 border-0 rounded-full px-4 py-2.5 text-sm text-slate-600 focus:ring-2 focus:ring-blue-500"
            aria-label="Itens por página"
          >
            <option [value]="5">5 posts</option>
            <option [value]="10">10 posts</option>
            <option [value]="25">25 posts</option>
          </select>
        </div>
      </div>

      <!-- Info de resultados -->
      @if (textoBusca()) {
      <div class="mt-3 flex items-center gap-2 text-sm text-slate-500">
        <span>{{ postsFiltrados().length }} resultado(s) para</span>
        <span class="bg-blue-100 text-blue-700 px-2 py-0.5 rounded-full text-xs font-medium">
          "{{ textoBusca() }}"
        </span>
        <button
          (click)="onBusca('')"
          class="text-slate-400 hover:text-red-500 transition-all duration-200"
          aria-label="Limpar busca"
        >
          <i class="fa-solid fa-xmark"></i>
        </button>
      </div>
      }
    </div>

    <!-- NOTE: Feed de Posts (Cards) -->
    <div class="posts-feed__list flex flex-col gap-4">
      @for (post of postsPaginados(); track post.id) {
      <!-- Card do Post estilo Facebook -->
      <article
        class="post-card bg-white rounded-xl shadow-sm hover:shadow-md border border-slate-200 transition-all duration-200"
      >
        <!-- Header do Card: Avatar + Autor + Data -->
        <div class="post-card__header flex items-center gap-3 p-4 border-b border-slate-100">
          <div
            class="w-10 h-10 rounded-full bg-blue-600 flex items-center justify-center text-white font-semibold"
          >
            {{ post.userId }}
          </div>
          <div class="flex-1">
            <h3 class="font-semibold text-slate-800 text-sm">Usuário {{ post.userId }}</h3>
            <p class="text-xs text-slate-400">
              <i class="fa-solid fa-clock mr-1"></i>
              há {{ post.id }} horas
            </p>
          </div>
          <!-- Menu de opções -->
          <button
            class="text-slate-400 hover:text-slate-600 p-2 hover:bg-slate-100 rounded-full transition-all duration-200"
            [attr.aria-label]="'Opções do post ' + post.id"
          >
            <i class="fa-solid fa-ellipsis"></i>
          </button>
        </div>

        <!-- Corpo do Card: Título + Conteúdo -->
        <div class="post-card__body p-4">
          <h2 class="font-bold text-slate-900 text-lg mb-2 leading-tight">
            {{ post.title }}
          </h2>
          <p class="text-slate-600 text-sm leading-relaxed line-clamp-3">
            {{ post.body }}
          </p>
        </div>

        <!-- Footer do Card: Ações -->
        <div
          class="post-card__footer flex items-center justify-between p-3 border-t border-slate-100 bg-slate-50/50 rounded-b-xl"
        >
          <!-- Botões de ação à esquerda -->
          <div class="flex items-center gap-1">
            <a
              [routerLink]="['/post', post.id]"
              class="flex items-center gap-2 px-3 py-2 text-slate-600 hover:bg-slate-200 rounded-lg text-sm font-medium transition-all duration-200"
              [attr.aria-label]="'Ver comentários do post ' + post.title"
            >
              <i class="fa-regular fa-comment"></i>
              <span class="hidden sm:inline">Comentários</span>
            </a>
          </div>

          <!-- Botões de ação à direita -->
          <div class="flex items-center gap-1">
            <a
              [routerLink]="['/post', post.id, 'edit']"
              class="flex items-center gap-2 px-3 py-2 text-blue-600 hover:bg-blue-50 rounded-lg text-sm font-medium transition-all duration-200"
              [attr.aria-label]="'Editar post ' + post.title"
            >
              <i class="fa-solid fa-pen"></i>
              <span class="hidden sm:inline">Editar</span>
            </a>
            <button
              (click)="openDeleteModal(post.id)"
              class="flex items-center gap-2 px-3 py-2 text-red-600 hover:bg-red-50 rounded-lg text-sm font-medium transition-all duration-200"
              [attr.aria-label]="'Excluir post ' + post.title"
            >
              <i class="fa-solid fa-trash"></i>
              <span class="hidden sm:inline">Excluir</span>
            </button>
          </div>
        </div>
      </article>
      } @empty {
      <!-- Estado vazio -->
      <div
        class="empty-state bg-white rounded-xl shadow-sm p-8 text-center border border-slate-200"
      >
        <div
          class="w-16 h-16 mx-auto mb-4 rounded-full bg-slate-100 flex items-center justify-center"
        >
          <i class="fa-solid fa-inbox text-2xl text-slate-400"></i>
        </div>
        @if (textoBusca()) {
        <p class="text-slate-600">
          Nenhum post encontrado para "<strong>{{ textoBusca() }}</strong
          >"
        </p>
        <button (click)="onBusca('')" class="mt-3 text-blue-600 hover:underline text-sm">
          Limpar busca
        </button>
        } @else {
        <p class="text-slate-600">Nenhum post disponível.</p>
        <a routerLink="/post/novo" class="mt-3 inline-block text-blue-600 hover:underline text-sm">
          Criar primeiro post
        </a>
        }
      </div>
      }
    </div>

    <!-- NOTE: Paginação estilizada -->
    @if (totalPaginas() > 1) {
    <div class="posts-pagination bg-white rounded-xl shadow-sm p-4 mt-6 border border-slate-200">
      <div class="flex flex-col sm:flex-row items-center justify-between gap-4">
        <p class="text-sm text-slate-500">
          Página <span class="font-semibold text-slate-700">{{ paginaAtual() }}</span> de
          <span class="font-semibold text-slate-700">{{ totalPaginas() }}</span>
        </p>

        <div class="flex items-center gap-1">
          <!-- Botão anterior -->
          <button
            (click)="paginaAnterior()"
            [disabled]="paginaAtual() === 1"
            class="flex items-center gap-1 px-3 py-2 rounded-lg text-sm font-medium transition-all duration-200"
            [class]="
              paginaAtual() === 1
                ? 'text-slate-300 cursor-not-allowed'
                : 'text-slate-600 hover:bg-slate-100'
            "
          >
            <i class="fa-solid fa-chevron-left text-xs"></i>
            <span class="hidden sm:inline">Anterior</span>
          </button>

          <!-- Números das páginas -->
          <div class="flex items-center gap-1">
            @for (pagina of numerosPaginas(); track pagina) { @if (pagina === 1 || pagina ===
            totalPaginas() || (pagina >= paginaAtual() - 1 && pagina <= paginaAtual() + 1)) {
            <button
              (click)="irParaPagina(pagina)"
              class="w-9 h-9 rounded-lg text-sm font-medium transition-all duration-200"
              [class]="
                pagina === paginaAtual()
                  ? 'bg-blue-600 text-white'
                  : 'text-slate-600 hover:bg-slate-100'
              "
            >
              {{ pagina }}
            </button>
            } @else if (pagina === paginaAtual() - 2 || pagina === paginaAtual() + 2) {
            <span class="w-9 h-9 flex items-center justify-center text-slate-400">...</span>
            } }
          </div>

          <!-- Botão próximo -->
          <button
            (click)="proximaPagina()"
            [disabled]="paginaAtual() === totalPaginas()"
            class="flex items-center gap-1 px-3 py-2 rounded-lg text-sm font-medium transition-all duration-200"
            [class]="
              paginaAtual() === totalPaginas()
                ? 'text-slate-300 cursor-not-allowed'
                : 'text-slate-600 hover:bg-slate-100'
            "
          >
            <span class="hidden sm:inline">Próximo</span>
            <i class="fa-solid fa-chevron-right text-xs"></i>
          </button>
        </div>
      </div>
    </div>
    } }
  </section>

  <!-- NOTE: Modal de confirmação de exclusão -->
  @if (showDeleteModal()) {
  <div class="fixed inset-0 z-50 flex items-center justify-center p-4">
    <!-- Overlay -->
    <div class="fixed inset-0 bg-black/50 backdrop-blur-sm" (click)="closeDeleteModal()"></div>

    <!-- Modal Content -->
    <div
      class="relative bg-white rounded-2xl shadow-2xl p-6 max-w-sm w-full animate-in zoom-in-95 duration-200"
    >
      <!-- Ícone -->
      <div class="w-12 h-12 mx-auto mb-4 rounded-full bg-red-100 flex items-center justify-center">
        <i class="fa-solid fa-trash text-red-600 text-xl"></i>
      </div>

      <h2 class="text-xl font-bold text-slate-900 text-center mb-2">Excluir post?</h2>

      <p class="text-slate-500 text-center text-sm mb-6">
        Tem certeza que deseja excluir o post #{{ postToDeleteId() }}? Esta ação não pode ser
        desfeita.
      </p>

      <div class="flex gap-3">
        <button
          (click)="closeDeleteModal()"
          class="flex-1 px-4 py-2.5 bg-slate-100 text-slate-700 rounded-xl hover:bg-slate-200 font-medium transition-all duration-200"
        >
          Cancelar
        </button>
        <button
          (click)="confirmDelete()"
          class="flex-1 px-4 py-2.5 bg-red-600 text-white rounded-xl hover:bg-red-700 font-medium transition-all duration-200"
        >
          <i class="fa-solid fa-trash mr-2"></i>
          Excluir
        </button>
      </div>
    </div>
  </div>
  }

  <!-- NOTE: Floating Action Button para criar novo post -->
  <a
    routerLink="/post/novo"
    class="fixed bottom-6 right-6 w-14 h-14 bg-blue-600 text-white rounded-full shadow-lg z-50 flex items-center justify-center hover:bg-blue-700 transition-colors"
    aria-label="Criar novo post"
  >
    <i class="fa-solid fa-plus text-xl"></i>
  </a>
</div>
